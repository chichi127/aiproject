<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‹¤ì‹œê°„ ê°ì • ë¶„ì„</title>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #e2e8ee, #f9fafc);
            text-align: center;
            padding: 40px;
            margin: 0;
        }
        h1 {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 30px;
        }
        #video-box {
            display: inline-block;
            padding: 16px;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        #video-feed {
            width: 640px;
            height: 480px;
            border-radius: 12px;
        }
        #emotion {
            font-size: 2em;
            margin: 20px auto;
            background: #fff;
            padding: 12px 24px;
            border-radius: 12px;
            display: inline-block;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        #micro {
            font-size: 20px;
            font-weight: bold;
            color: red;
            margin-top: 10px;
            height: 30px;
        }
        #stats {
            font-size: 16px;
            margin-top: 10px;
        }
        #log {
            margin-top: 30px;
            text-align: left;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        }
        #log div {
            font-size: 16px;
            margin-bottom: 6px;
        }
        #face-alert {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 80, 80, 0.95);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 18px;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <h1>ğŸ“· ì›¹ìº  ê°ì • ë¶„ì„</h1>

    <!-- ì–¼êµ´ ë¯¸ê²€ì¶œ íŒì—… -->
    <div id="face-alert">ì–¼êµ´ì„ í™”ë©´ì— ë¹„ì¶°ì£¼ì„¸ìš” âŒ</div>

    <div id="video-box">
        <!-- ì‹¤ì‹œê°„ ë¹„ë””ì˜¤ -->
        <img id="video-feed" src="{{ url_for('video_feed') }}" alt="ì›¹ìº  ì˜ìƒ ìŠ¤íŠ¸ë¦¬ë° ì•ˆë¨">
    </div>

    <!-- ì‹¤ì‹œê°„ ê°ì • -->
    <div id="emotion">{{ expression }}</div>

    <!-- ë¯¸ì„¸í‘œì • ê°ì§€ ì•Œë¦¼ -->
    <div id="micro"></div>

    <!-- ë¯¸ì„¸í‘œì • í†µê³„ -->
    <div id="stats">
        ì´ ê°ì • ë³€í™” íšŸìˆ˜: <span id="total_changes">0</span>íšŒ<br>
        ë¯¸ì„¸í‘œì • ê°ì§€ íšŸìˆ˜: <span id="micro_count">0</span>íšŒ<br>
        ë¯¸ì„¸í‘œì • ë¹„ìœ¨: <span id="micro_percent">0%</span>
    </div>

    <!-- ê°ì • ì§€ì† ë¡œê·¸ -->
    <div id="log">
        <div>ê°ì • ë¡œê·¸ ë¡œë”© ì¤‘...</div>
    </div>

    <script>
        // í˜„ì¬ ê°ì • ìƒíƒœ ê³„ì† ë¶ˆëŸ¬ì˜¤ê¸°
        setInterval(() => {
            fetch("/current_expression")
                .then(res => res.json())
                .then(data => {
                    const emotionDiv = document.getElementById("emotion");
                    const faceAlert = document.getElementById("face-alert");
                    emotionDiv.innerText = data.expression;

                    if (data.expression.includes("ì–¼êµ´ì„ ë¹„ì¶”ì„¸ìš”")) {
                        faceAlert.style.display = "block";
                        console.log("ì–¼êµ´ì´ ì¸ì‹ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                    } else {
                        faceAlert.style.display = "none";
                    }
                });
        }, 1000);

        // ê°ì • ë³€í™” ë¡œê·¸ ë¶ˆëŸ¬ì˜¤ê¸°
        setInterval(() => {
            fetch("/expression_log")
                .then(res => res.json())
                .then(data => {
                    const logDiv = document.getElementById("log");
                    logDiv.innerHTML = data.log.map(line => `<div>${line}</div>`).join('');
                });
        }, 1500);

        // ë¯¸ì„¸í‘œì • ê°ì§€ ì—¬ë¶€
        setInterval(() => {
            fetch("/microexpression")
                .then(res => res.json())
                .then(data => {
                    const microDiv = document.getElementById("micro");
                    if (data.micro) {
                        microDiv.innerText = "âš¡ ë¯¸ì„¸í‘œì • ê°ì§€!";
                        setTimeout(() => {
                            microDiv.innerText = "";
                        }, 1500);
                    }
                });
        }, 1000);

        // ë¯¸ì„¸í‘œì • í†µê³„
        setInterval(() => {
            fetch("/micro_stats")
                .then(res => res.json())
                .then(data => {
                    document.getElementById("micro_count").innerText = data.count;
                    document.getElementById("micro_percent").innerText = data.percent + "%";
                    document.getElementById("total_changes").innerText = data.total;
                });
        }, 2000);
    </script>
    <a href="/" class="back-button">â† ì²˜ìŒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
</body>
</html>
